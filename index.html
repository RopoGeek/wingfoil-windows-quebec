<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WIND-FILTRATOR - Quebec</title>

  <!-- SEO & Share -->
  <meta name="description" content="WIND-FILTRATOR - Quebec : filtrez les fenêtres favorables aux sports de vent (vent, marée, direction) pour des spots populaires autour de Québec.">
  <meta property="og:title" content="WIND-FILTRATOR - Quebec">
  <meta property="og:description" content="Filtre et visualisation des conditions favorables (vents, marées, directions) pour Beauport, Ste-Anne, St-Jean et Ange-Gardien.">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="fr_CA">
  <meta property="og:site_name" content="WIND-FILTRATOR">
  <meta http-equiv="refresh" content="3600" />
  <link rel="icon" href="favicon.ico" type="image/x-icon">

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>

  <!-- Project styles -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>WIND-FILTRATOR - Quebec</h1>
    <span class="pill">Heure locale / Local time (America/Toronto)</span>
  </header>

  <!-- Intro (collapsed by default to save space) -->
  <details class="collapsible">
    <summary>Introduction</summary>
    <div class="content">
      <p class="lang-fr">
        Ce site offre une <b>vision générale</b> des <b>moments intéressants</b> pour les <b>sports de vent</b>
        au cours de la semaine à venir, selon des <b>préférences personnelles</b> (rafale minimale, secteurs de vent, marée).
        Les spots inclus sont des <b>sites populaires autour de la ville de Québec</b> : Baie de Beauport, Ste-Anne-de-Beaupré,
        St-Jean (Île d’Orléans) et Ange-Gardien. Pour une <b>consultation détaillée</b> :
        <a href="https://asvq.ca" target="_blank" rel="noopener">asvq.ca</a>,
        <a href="https://windy.app" target="_blank" rel="noopener">Windy.app</a>,
        <a href="https://www.windfinder.com" target="_blank" rel="noopener">Windfinder</a>,
        <a href="https://www.windguru.cz" target="_blank" rel="noopener">Windguru</a> et
        <a href="https://weather.gc.ca/marine/index_e.html" target="_blank" rel="noopener">Environnement Canada (Marine)</a>.
      </p>
      <p class="lang-en">
        This site provides a <b>high-level overview</b> of <b>promising windows</b> for <b>wind sports</b> over the coming week,
        based on your <b>personal filters</b> (min gust, wind sectors, tide).
        Included spots are <b>popular locations around Québec City</b>: Baie de Beauport, Ste-Anne-de-Beaupré,
        St-Jean (Île d’Orléans), and Ange-Gardien. For <b>detailed forecasts</b>:
        <a href="https://asvq.ca" target="_blank" rel="noopener">asvq.ca</a>,
        <a href="https://windy.app" target="_blank" rel="noopener">Windy.app</a>,
        <a href="https://www.windfinder.com" target="_blank" rel="noopener">Windfinder</a>,
        <a href="https://www.windguru.cz" target="_blank" rel="noopener">Windguru</a>, and
        <a href="https://weather.gc.ca/marine/index_e.html" target="_blank" rel="noopener">Environment Canada Marine</a>.
      </p>
      <p class="lang-fr"><b>Modèles de vent :</b> Open-Meteo (sélection auto). Modèles courants : <b>HRDPS</b>, <b>NAM</b>, <b>HRRR</b>.</p>
      <p class="lang-en"><b>Wind models:</b> via Open-Meteo (auto selection). Commonly used: <b>HRDPS</b>, <b>NAM</b>, <b>HRRR</b>.</p>
    </div>
  </details>

  <!-- MAP: smaller, above filters, open by default so user can collapse -->
  <details class="collapsible" id="mapSection" open>
    <summary>Carte / Map</summary>
    <div class="content">
      <div id="mapWrap"><div id="map"></div></div>
      <p class="muted" style="margin-top:6px">
        <span class="lang-fr">Les secteurs affichés représentent les <b>directions de vent autorisées</b> que vous avez choisies pour le spot actif (le vent souffle <b>depuis</b> ces secteurs).</span><br/>
        <span class="lang-en">Shown sectors reflect your <b>allowed wind directions</b> for the active spot (wind blows <b>from</b> these sectors).</span>
      </p>
    </div>
  </details>

  <!-- Spot conditions (collapsed by default) -->
  <details class="collapsible">
    <summary>Conditions par site / Spot Conditions</summary>
    <div class="content">
      <ul>
        <li><span class="lang-fr"><b>Baie de Beauport</b> — par défaut : rafales ≥10 nœuds, toute direction</span><br/>
            <span class="lang-en"><b>Baie de Beauport</b> — default: gust ≥10 kn, any direction</span></li>
        <li><span class="lang-fr"><b>Ste-Anne-de-Beaupré</b> — par défaut : SW 200–250°, marée <b>montante</b>, rafales ≥10 nœuds</span><br/>
            <span class="lang-en"><b>Ste-Anne-de-Beaupré</b> — default: SW 200–250°, <b>rising</b> tide, gust ≥10 kn</span></li>
        <li><span class="lang-fr"><b>St-Jean, Île d’Orléans</b> — par défaut : NE 30–70°, marée <b>descendante</b>, rafales ≥10 nœuds</span><br/>
            <span class="lang-en"><b>St-Jean, Île d’Orléans</b> — default: NE 30–70°, <b>falling</b> tide, gust ≥10 kn</span></li>
        <li><span class="lang-fr"><b>Ange-Gardien</b> — par défaut : SW 200–250°, marée <b>montante</b>, rafales ≥10 nœuds</span><br/>
            <span class="lang-en"><b>Ange-Gardien</b> — default: SW 200–250°, <b>rising</b> tide, gust ≥10 kn</span></li>
      </ul>
    </div>
  </details>

  <!-- Tides (collapsed by default) -->
  <details class="collapsible">
    <summary>Marées / Tides</summary>
    <div class="content">
      <p class="muted">
        <span class="lang-fr">La fine bande colorée à côté de chaque jour indique la phase de marée (vert = montante, rouge = descendante, gris = étale). C’est une <b>approximation</b> basée sur la Baie de Beauport, avec décalages simples pour les autres spots.</span><br/>
        <span class="lang-en">The thin colored stripe beside each day shows tide phase (green = rising, red = falling, grey = slack). It’s an <b>approximation</b> based on Baie de Beauport with simple offsets for other spots.</span>
      </p>
      <ul class="muted">
        <li><a href="https://tides.gc.ca/en/stations/03250" target="_blank" rel="noopener">Baie de Beauport — 03250</a></li>
        <li><a href="https://tides.gc.ca/en/stations/03087" target="_blank" rel="noopener">Ste-Anne-de-Beaupré — 03087</a></li>
        <li><a href="https://tides.gc.ca/en/stations/03105" target="_blank" rel="noopener">St-Jean, Île d’Orléans — 03105</a></li>
      </ul>
      <p class="muted">
        <span class="lang-fr">Ange-Gardien : pas de station. Utilisez un horaire approximatif à mi-chemin entre Beauport et Ste-Anne.</span><br/>
        <span class="lang-en">Ange-Gardien: no station. Use a time roughly midway between Beauport and Ste-Anne.</span>
      </p>
    </div>
  </details>

  <p class="muted">
    <span class="lang-fr">Basculer <b>Jour (06–21)</b> / <b>24h (00–23)</b>. Colonnes = jours, lignes = heures. Les préférences (rafale min, secteurs, marée) sont enregistrées localement.</span><br/>
    <span class="lang-en">Toggle <b>Daylight (06–21)</b> / <b>All hours (00–23)</b>. Columns = days, rows = hours. Preferences (min gust, sectors, tide) are saved locally.</span>
  </p>

  <div class="controls">
    <div class="tabs" id="tabs"></div>
    <div class="viewtoggles">
      <button class="toggle active" id="tgl-daylight"><span class="lang-fr">Jour</span> / <span class="lang-en">Daylight</span></button>
      <button class="toggle" id="tgl-all"><span class="lang-fr">24h</span> / <span class="lang-en">All hours</span></button>
    </div>
  </div>

  <!-- Per-spot filters -->
  <div class="settings-wrap" id="settingsWrap">
    <div class="settings-grid">
      <div class="settings-section">
        <h3><span class="lang-fr">Rafale min (nœuds)</span> / <span class="lang-en">Minimum gust (kn)</span></h3>
        <select id="minGustSelect"></select>
      </div>

      <div class="settings-section">
        <h3><span class="lang-fr">Directions permises</span> / <span class="lang-en">Allowed directions</span></h3>
        <div class="dir-grid" id="dirGrid"></div>
        <div class="preset-row">
          <span class="preset" data-preset="any"><span class="lang-fr">Toutes</span> / <span class="lang-en">Any</span></span>
          <span class="preset" data-preset="sw">SW 200–250°</span>
          <span class="preset" data-preset="ne">NE 30–70°</span>
          <span class="preset" data-preset="none"><span class="lang-fr">Effacer</span> / <span class="lang-en">Clear</span></span>
        </div>
      </div>

      <div class="settings-section">
        <h3><span class="lang-fr">Marée</span> / <span class="lang-en">Tide</span></h3>
        <div class="checkboxes">
          <label><input type="checkbox" id="tideRise"> <span class="lang-fr">Montante</span> / <span class="lang-en">Rising</span></label><br/>
          <label><input type="checkbox" id="tideFall"> <span class="lang-fr">Descendante</span> / <span class="lang-en">Falling</span></label>
        </div>
        <p class="muted" style="margin-top:6px">
          <span class="lang-fr">Si les deux sont désactivées, la marée est ignorée. Si les deux sont activées, l’une ou l’autre phase est acceptée.</span><br/>
          <span class="lang-en">If both are off, tide is ignored. If both are on, either phase is allowed.</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Sticky info bar -->
  <div class="info-bar" id="infoBar">
    <span class="info-dim"><span class="lang-fr">Touchez une cellule</span> / <span class="lang-en">Tap a cell</span></span>
  </div>

  <!-- Legend -->
  <div class="legend">
    <span class="swatch c-g1"></span> <span class="lang-fr">10–14 nœuds</span> / <span class="lang-en">10–14 kn</span>
    <span class="swatch c-g2"></span> <span class="lang-fr">14–18 nœuds</span> / <span class="lang-en">14–18 kn</span>
    <span class="swatch c-y1"></span> <span class="lang-fr">18–21 nœuds</span> / <span class="lang-en">18–21 kn</span>
    <span class="swatch c-y2"></span> <span class="lang-fr">21–25 nœuds</span> / <span class="lang-en">21–25 kn</span>
    <span class="swatch c-r1"></span> <span class="lang-fr">25–30 nœuds</span> / <span class="lang-en">25–30 kn</span>
    <span class="swatch c-r2"></span> <span class="lang-fr">≥30 nœuds</span> / <span class="lang-en">≥30 kn</span>
    &nbsp; | &nbsp;
    <span class="swatch c-neutral"></span> <span class="lang-fr">Données manquantes</span> / <span class="lang-en">Missing data</span>
    <span class="swatch c-blank"></span> <span class="lang-fr">Critères non remplis</span> / <span class="lang-en">Criteria not met</span>
  </div>

  <div id="matrices"></div>

  <!-- App logic -->
  <script src="script.js"></script>
</body>
</html>
